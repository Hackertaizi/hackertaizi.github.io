<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hackertaizi.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="太子的个人博客">
<meta property="og:url" content="https://hackertaizi.github.io/index.html">
<meta property="og:site_name" content="太子的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Taizi">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hackertaizi.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>太子的个人博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">太子的个人博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Have a nice day !</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/categories/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Taizi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/Hadoop/Hive/%E5%85%B3%E4%BA%8E%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Hadoop/Hive/%E5%85%B3%E4%BA%8E%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">关于窗口函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-10 18:30:46" itemprop="dateCreated datePublished" datetime="2024-09-10T18:30:46+08:00">2024-09-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-11 18:48:23" itemprop="dateModified" datetime="2024-09-11T18:48:23+08:00">2024-09-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hadoop/Hive/" itemprop="url" rel="index"><span itemprop="name">Hive</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="关于窗口函数"><a href="#关于窗口函数" class="headerlink" title="关于窗口函数"></a>关于窗口函数</h1><h2 id="窗口函数基本语法"><a href="#窗口函数基本语法" class="headerlink" title="窗口函数基本语法"></a>窗口函数基本语法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">窗口函数([参数]) OVER (  </span><br><span class="line">    [PARTITION BY &lt;分组列&gt;]  </span><br><span class="line">    [ORDER BY &lt;排序列&gt; [ASC|DESC]]  </span><br><span class="line">    [ROWS|RANGE BETWEEN &lt;开始行&gt; AND &lt;结束行&gt;]  </span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="如何理解窗口函数"><a href="#如何理解窗口函数" class="headerlink" title="如何理解窗口函数"></a>如何理解窗口函数</h2><p>首先，窗口函数在查询中的执行顺序，是在查询结果集生成之前，聚合计算之后进行的，当然，窗口函数后面还有全局排序ORDER子句以及LIMIT子句。</p>
<p>根据窗口函数的sql执行顺序，可以将窗口函数理解为二次查询，也就是基本的查询和聚合计算先进行，得到初步的结果，然后窗口函数在这个结果上进行二次查询计算。</p>
<h2 id="窗口函数的特性"><a href="#窗口函数的特性" class="headerlink" title="窗口函数的特性"></a>窗口函数的特性</h2><ul>
<li><strong>分组和排序</strong>：窗口函数内部使用<code>PARTITION</code>关键字指定一个或多个列进行分组，使用<code>ORDER BY</code>关键字进行排序。</li>
<li><strong>不改变行数</strong>：与传统的聚合函数不同，<strong>窗口函数不会减少结果集中的行数，而是为每一行返回一个结果。</strong></li>
<li><strong>灵活性</strong>：窗口函数支持复杂的分析操作，如计算排名、分组统计、移动平均等。</li>
</ul>
<h2 id="窗口范围的指定"><a href="#窗口范围的指定" class="headerlink" title="窗口范围的指定"></a>窗口范围的指定</h2><p>在窗口函数的基本语法中，最后一部分是指定窗口的范围，由于多数情况下窗口函数的默认范围和我们希望的默认范围一样，都是整个数据集。因此我们经常会忽略窗口范围的指定。</p>
<p>然而，<strong>在很多特殊情况下，窗口函数的默认范围并不是整个数据集</strong>，按照一贯的思路使用窗口函数将出现问题。</p>
<p>以下就各种情况下的窗口函数默认范围做出解释：</p>
<ul>
<li><p><strong>包含<code>ORDER BY</code>子句的情况</strong></p>
<p>当<code>OVER()</code>子句中包含<code>ORDER BY</code>子句时，窗口函数的默认窗口范围是<strong>从当前分区（如果有<code>PARTITION BY</code>子句）中的第一行开始，到当前行为止</strong>。这相当于<code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code>，但需要注意的是，这里的“范围”是基于值的范围，但由于<code>ORDER BY</code>的存在，它实际上是以行为单位进行计算的。然而，严格来说，Hive中更常用的是基于行的范围定义（<code>ROWS BETWEEN ... AND ...</code>），但在此上下文中，我们讨论的是默认行为。</p>
</li>
<li><p><strong>不包含<code>ORDER BY</code>子句的情况</strong><br>当<code>OVER()</code>子句中不包含<code>ORDER BY</code>子句时，窗口函数的默认窗口范围是<strong>整个分区（如果有<code>PARTITION BY</code>子句）或整个结果集（如果没有<code>PARTITION BY</code>子句）</strong>。这相当于<code>ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING</code>，即窗口包含从第一行到最后一行的所有行。</p>
</li>
</ul>
<h3 id="自定义窗口范围"><a href="#自定义窗口范围" class="headerlink" title="自定义窗口范围"></a>自定义窗口范围</h3><ul>
<li><p><strong>基于行的范围：</strong>使用<code>ROWS</code>关键字定义</p>
<p><code>ROWS</code></p>
<ul>
<li><strong>含义</strong>：<code>ROWS</code>关键字用于定义基于物理行数的窗口范围。即，窗口包含的行数是根据它们在结果集中的物理位置（即行号）来确定的，而不是根据行中的值。</li>
<li><strong>用法示例</strong>：<code>ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING</code>表示窗口包含当前行、前一行和后一行，总共三行。</li>
</ul>
</li>
<li><p><strong>基于值的范围：</strong>使用<code>RANGE</code>关键字定义</p>
<p><code>RANGE</code></p>
<ul>
<li><strong>含义</strong>：<code>RANGE</code>关键字用于定义基于值的窗口范围。即，窗口包含的行是根据它们与当前行在某个列上的值的关系来确定的。这允许窗口包含的行数不固定，只要它们的值在指定的范围内即可。</li>
<li><strong>用法示例</strong>：<code>RANGE BETWEEN 10 PRECEDING AND 20 FOLLOWING</code>（注意：这种用法在Hive中可能不直接支持具体的数值范围，因为<code>RANGE</code>通常与<code>ORDER BY</code>中的列值相关，而不是具体的行数。但这里仅用于说明<code>RANGE</code>的概念。）实际上，Hive中的<code>RANGE</code>更常用于与<code>ORDER BY</code>子句中的列值结合，如<code>RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING</code>，表示从当前行开始到分区中值大于当前行值的最后一行。</li>
</ul>
</li>
<li><p><strong>关键字解释：</strong></p>
<ul>
<li><code>CURRENT ROW</code><ul>
<li><strong>含义</strong>：表示当前正在处理的行。在窗口函数中，<code>CURRENT ROW</code>是窗口范围的默认起点或参考点，除非明确指定了其他起点。</li>
<li><strong>用法</strong>：通常与<code>PRECEDING</code>或<code>FOLLOWING</code>关键字结合使用，以指定从当前行开始向前或向后扩展多少行。</li>
</ul>
</li>
<li><code>UNBOUNDED PRECEDING</code><ul>
<li><strong>含义</strong>：表示窗口的起始点是分区（如果有<code>PARTITION BY</code>）或整个结果集（如果没有<code>PARTITION BY</code>）的第一行。</li>
<li><strong>用法</strong>：用于指定窗口的起始边界，表示从第一行开始到当前行（或指定行）的所有行都包含在窗口内。</li>
</ul>
</li>
<li><code>UNBOUNDED FOLLOWING</code><ul>
<li><strong>含义</strong>：表示窗口的结束点是分区（如果有<code>PARTITION BY</code>）或整个结果集的最后一行。然而，在实际使用中，<code>UNBOUNDED FOLLOWING</code>通常不会单独使用，因为它会导致窗口包含未来（即尚未处理的）行，这在大多数窗口函数的应用场景中是没有意义的。</li>
<li><strong>注意</strong>：尽管<code>UNBOUNDED FOLLOWING</code>在技术上存在，但在定义窗口范围时，它通常不会单独使用，而是与其他关键字结合使用来指定一个有限的窗口范围。然而，在某些特定的聚合或分析函数中，它可能以不同的方式被解释或使用。</li>
</ul>
</li>
<li><code>PRECEDING</code><ul>
<li>用法：用于指定相对于<code>CURRENT ROW</code>的行数偏移量，表示当前行之前的行，通常与数字（如<code>1 PRECEDING</code>）或<code>UNBOUNDED</code>结合使用来定义窗口的边界。</li>
</ul>
</li>
<li><code>FOLLOWING</code><ul>
<li>用法：用于指定相对于<code>CURRENT ROW</code>的行数偏移量，表示当前行之后的行，通常与数字（如<code>1 FOLLOWING</code>）或<code>UNBOUNDED</code>结合使用来定义窗口的边界。</li>
</ul>
</li>
</ul>
</li>
<li><p>示例：</p>
<ul>
<li><p><code>ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING</code>：表示窗口包含当前行、前一行和后一行。</p>
</li>
<li><p><code>ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code>：表示窗口从分区或结果集的第一行开始，到当前行为止。</p>
</li>
<li><p><code>ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING</code>（尽管不常见）：理论上表示窗口从当前行开始，到分区或结果集的最后一行。但在实际应用中，这样的窗口范围可能不是很有用，因为大多数窗口函数不需要考虑未来的行</p>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/flink/1.%20flink%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/flink/1.%20flink%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">1.flink快速入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-07 19:06:10" itemprop="dateCreated datePublished" datetime="2024-08-07T19:06:10+08:00">2024-08-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-26 19:16:27" itemprop="dateModified" datetime="2024-11-26T19:16:27+08:00">2024-11-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">流数据处理</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/flink/" itemprop="url" rel="index"><span itemprop="name">flink</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>541</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-flink快速入门"><a href="#1-flink快速入门" class="headerlink" title="1. flink快速入门"></a>1. flink快速入门</h1><h2 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h2><h3 id="1-1-flink介绍"><a href="#1-1-flink介绍" class="headerlink" title="1.1 flink介绍"></a>1.1 flink介绍</h3><p>flink是一个框架和分布式处理引擎，用于对无界和有界数据流进行有状态计算。</p>
<blockquote>
<p>状态：是指数据流处理过程中需要保存的中间结果。</p>
</blockquote>
<h3 id="1-2-无界流和有界流"><a href="#1-2-无界流和有界流" class="headerlink" title="1.2 无界流和有界流"></a>1.2 无界流和有界流</h3><ul>
<li>无界数据流：<ul>
<li>有定义流的开始，没有定义流的结束</li>
<li>数据无休止产生</li>
<li>数据必须持续处理，不能等所有数据到达在处理，因为数据是无限的</li>
</ul>
</li>
<li>有界数据流<ul>
<li>有定义流的开始，也有定义流的结束</li>
<li>可以在获取所有数据后再计算</li>
<li>数据可以被排序，不需要有序获取</li>
<li>有界数据流处理通常称为批处理</li>
</ul>
</li>
</ul>
<h2 id="1-离线计算与事实计算"><a href="#1-离线计算与事实计算" class="headerlink" title="1. 离线计算与事实计算"></a>1. 离线计算与事实计算</h2><h3 id="1-1-离线计算"><a href="#1-1-离线计算" class="headerlink" title="1.1 离线计算"></a>1.1 离线计算</h3><p>所谓离线计算，即输入表是静态表，数据是确定的。用于数据处理的sql只需要执行一次即可得到最终的输出结果。</p>
<h3 id="1-2-实时计算"><a href="#1-2-实时计算" class="headerlink" title="1.2 实时计算"></a>1.2 实时计算</h3><p>在实时计算中，输入表是动态的，输入的数据随着时间不断产生，用于数据处理的sql需要随着输入数据的变化多次执行，因此，输出数据也是动态变化的。</p>
<img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/flink/1.%20flink%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/image-20240807191030807.png" class="" title="image-20240807191030807">

<h2 id="2-flink的特点"><a href="#2-flink的特点" class="headerlink" title="2. flink的特点"></a>2. flink的特点</h2><ul>
<li><p>批流一体：同一套代码，同一个sql，可以跑流也可以跑批</p>
</li>
<li><p>性能卓越：高吞吐，低延迟</p>
</li>
<li><p>规模计算：支持水平扩展架构，支持超大状态（计算过程中需要存储的数据）与增量检查点机制</p>
</li>
<li><p>生态兼容：支持与Yarn、Kubernetes集成，支持单机模式运行</p>
</li>
<li><p>高容错：故障自动重试、一致性检查点、保证故障场景下的精确一次（exactly once）的状态一致性</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E5%85%B6%E4%BB%96/Floyd%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%85%B6%E4%BB%96/Floyd%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">Floyd算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-05 16:48:53" itemprop="dateCreated datePublished" datetime="2024-08-05T16:48:53+08:00">2024-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-20 13:21:42" itemprop="dateModified" datetime="2024-11-20T13:21:42+08:00">2024-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>946</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Floyd算法"><a href="#Floyd算法" class="headerlink" title="Floyd算法"></a>Floyd算法</h1><p>弗洛伊德算法（Floyd-Warshall算法），又称为插点法，是一种利用动态规划思想寻找给定加权图中多源点之间最短路径的算法。该算法以创始人之一、1978年图灵奖获得者、斯坦福大学计算机科学系教授罗伯特·弗洛伊德命名。以下是对弗洛伊德算法的详细介绍：</p>
<h3 id="一、算法概述"><a href="#一、算法概述" class="headerlink" title="一、算法概述"></a>一、算法概述</h3><ul>
<li><strong>目的</strong>：计算图中所有顶点对之间的最短路径。</li>
<li><strong>适用场景</strong>：适用于无负权回路的稠密图，可以正确处理有向图或负权的最短路径问题。</li>
<li><strong>时间复杂度</strong>：O(n^3)，其中n是图中顶点的数量。</li>
<li><strong>空间复杂度</strong>：O(n^2)，用于存储最短路径矩阵。</li>
</ul>
<h3 id="二、算法原理"><a href="#二、算法原理" class="headerlink" title="二、算法原理"></a>二、算法原理</h3><p>弗洛伊德算法通过三重循环遍历图中的每一个顶点作为中间点，来尝试更新所有顶点对之间的最短路径。具体步骤如下：</p>
<ol>
<li><p><strong>初始化</strong>：用一个二维数组<code>D</code>来存储任意两点之间的最短路径长度，初始时<code>D[i][j]</code>等于图中顶点<code>i</code>到顶点<code>j</code>的直接距离（如果<code>i</code>和<code>j</code>之间有边相连）或者无穷大（如果<code>i</code>和<code>j</code>之间无边相连）。</p>
</li>
<li><p><strong>三重循环</strong>：</p>
<ul>
<li>外层循环遍历每一个顶点<code>k</code>作为中间点。</li>
<li>中间和内层循环分别遍历起点<code>i</code>和终点<code>j</code>。</li>
<li>对于每一对顶点<code>i</code>和<code>j</code>，检查是否存在一个通过顶点<code>k</code>的路径，使得从<code>i</code>到<code>k</code>再到<code>j</code>的路径长度小于当前已知的<code>i</code>到<code>j</code>的最短路径长度。如果是，则更新<code>D[i][j]</code>为新的更短的路径长度。</li>
</ul>
</li>
<li><p><strong>结束</strong>：当所有顶点都作为中间点遍历完毕后，<code>D</code>数组中存储的就是所有顶点对之间的最短路径长度。</p>
</li>
</ol>
<h3 id="三、算法特点"><a href="#三、算法特点" class="headerlink" title="三、算法特点"></a>三、算法特点</h3><ul>
<li><p><strong>优点</strong>：</p>
<ul>
<li>容易理解，可以算出任意两个节点之间的最短距离。</li>
<li>代码编写简单。</li>
<li>适用于处理有向图或负权的最短路径问题。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>时间复杂度较高，不适合计算大量数据。</li>
</ul>
</li>
</ul>
<h3 id="四、算法应用"><a href="#四、算法应用" class="headerlink" title="四、算法应用"></a>四、算法应用</h3><p>弗洛伊德算法不仅用于求解最短路径问题，还可以用于计算有向图的传递闭包，即判断图中任意两点之间是否存在路径。此外，它还可以用于求解无向图的最小环问题，即找到一个包含至少三个顶点的环，使得环上的边权之和最小。</p>
<h3 id="五、示例"><a href="#五、示例" class="headerlink" title="五、示例"></a>五、示例</h3><p>假设有一个简单的图，顶点集为{A, B, C, D}，边和对应的权重如下：</p>
<ul>
<li>A-B: 1</li>
<li>B-C: 2</li>
<li>C-D: 3</li>
<li>A-C: 4</li>
</ul>
<p>应用弗洛伊德算法后，可以得到以下最短路径矩阵：</p>
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>B</td>
<td>∞</td>
<td>0</td>
<td>2</td>
<td>5</td>
</tr>
<tr>
<td>C</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>D</td>
<td>∞</td>
<td>∞</td>
<td>∞</td>
<td>0</td>
</tr>
</tbody></table>
<p>（注意：在实际应用中，无穷大通常用一个极大的数表示，如<code>0x3f3f3f3f</code>或<code>Integer.MAX_VALUE</code>等。）</p>
<p>以上就是对弗洛伊德算法的详细介绍，包括其原理、特点、应用以及示例。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">1.kafka快速入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-02 15:32:56" itemprop="dateCreated datePublished" datetime="2024-08-02T15:32:56+08:00">2024-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-26 19:15:37" itemprop="dateModified" datetime="2024-11-26T19:15:37+08:00">2024-11-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">流数据处理</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/" itemprop="url" rel="index"><span itemprop="name">kafka</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-kafka-快速入门"><a href="#1-kafka-快速入门" class="headerlink" title="1. kafka 快速入门"></a>1. kafka 快速入门</h1><h2 id="1-kafka架构"><a href="#1-kafka架构" class="headerlink" title="1. kafka架构"></a>1. kafka架构</h2><img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/6960b34cb7f157199eac5b33dfd1ab72.png" class="" title="6960b34cb7f157199eac5b33dfd1ab72">

<h2 id="2-基本概念"><a href="#2-基本概念" class="headerlink" title="2.  基本概念"></a>2.  基本概念</h2><h3 id="2-1-生产者（Producer）"><a href="#2-1-生产者（Producer）" class="headerlink" title="2.1 生产者（Producer）"></a>2.1 生产者（Producer）</h3><ul>
<li><strong>定义</strong>：生产者是发送消息的一方，负责创建消息并将其投递到Kafka中。</li>
<li><strong>功能</strong>：生产者通过Kafka的API将消息发送到指定的主题（Topic）。</li>
</ul>
<h3 id="2-2-消费者（Consumer）"><a href="#2-2-消费者（Consumer）" class="headerlink" title="2.2 消费者（Consumer）"></a>2.2 消费者（Consumer）</h3><ul>
<li><strong>定义</strong>：消费者是接收消息的一方，负责从Kafka中订阅并消费消息。</li>
<li><strong>消费者组（Consumer Group, CG）</strong>：由多个消费者组成，每个消费者组内的消费者负责消费不同分区的数据，一个分区只能由一个组内消费者消费，消费者组之间互不影响。</li>
</ul>
<h3 id="2-3-代理节点（Broker）"><a href="#2-3-代理节点（Broker）" class="headerlink" title="2.3 代理节点（Broker）"></a>2.3 代理节点（Broker）</h3><ul>
<li><strong>定义</strong>：对于Kafka而言，Broker可以简单地看作一个独立的Kafka服务节点或Kafka服务实例。</li>
<li><strong>功能</strong>：Broker负责接收生产者发送的消息，并将其存储到磁盘中，同时也负责为消费者提供消息。</li>
</ul>
<h3 id="2-4-主题（Topic）"><a href="#2-4-主题（Topic）" class="headerlink" title="2.4 主题（Topic）"></a>2.4 主题（Topic）</h3><ul>
<li><strong>定义</strong>：Kafka中的消息以主题为单位进行归类。</li>
<li><strong>特点</strong>：生产者将消息发送到特定的主题，而消费者则订阅主题并消费其中的消息。一个主题可以包含多个分区（Partition），以实现消息的并行处理和负载均衡。</li>
</ul>
<h3 id="2-5-分区（Partition）"><a href="#2-5-分区（Partition）" class="headerlink" title="2.5 分区（Partition）"></a>2.5 分区（Partition）</h3><ul>
<li><p><strong>定义</strong>：分区是主题的细分，一个分区只属于单个主题。</p>
</li>
<li><p><strong>特点</strong>：同一主题下的不同分区包含的消息是不同的，分区在存储层面可以看作一个可追加的日志（Log）文件。消息在被追加到分区日志文件的时候都会分配一个特定的偏移量（Offset），Kafka通过Offset来保证消息在分区内的顺序性。</p>
<blockquote>
<p>Offset（偏移量）用于唯一标识分区中每条消息的位置。它是一个长整型（long）的数字，每条消息被发送到分区时，都会被分配一个递增的Offset值。这个值帮助Kafka跟踪消息的顺序和位置，确保消息的有序性和一致性。</p>
<p>消费者通过指定Offset来读取分区中的消息。它们可以指定从特定的Offset开始读取，或者从分区的开始（Offset  0）或结束（最新的Offset）读取。Kafka还允许消费者将它们的读取位置（即Offset）保存起来，以便在发生故障或重启后能够继续从上次停止的地方开始读取消息。</p>
</blockquote>
</li>
</ul>
<h3 id="2-6-副本（Replica）"><a href="#2-6-副本（Replica）" class="headerlink" title="2.6 副本（Replica）"></a>2.6 副本（Replica）</h3><ul>
<li><strong>定义</strong>：Kafka为分区引入了多副本机制，以提升容灾能力。</li>
<li><strong>特点</strong>：同一分区的不同副本中保存的是相同的消息（在同一时刻，副本之间并非完全一样），副本之间是“一主多从”的关系。其中leader副本负责处理读写请求，follower副本只负责与leader副本的消息同步。当leader副本出现故障时，会从follower副本中重新选举新的leader副本对外提供服务。</li>
</ul>
<h3 id="2-7-ZooKeeper"><a href="#2-7-ZooKeeper" class="headerlink" title="2.7 ZooKeeper"></a>2.7 ZooKeeper</h3><ul>
<li><strong>定义</strong>：ZooKeeper是一个分布式协调服务，用于管理Kafka集群的元数据和控制器的选举等操作。</li>
<li><strong>功能</strong>：在Kafka中，ZooKeeper负责维护集群的元数据，如Broker的注册信息、主题的分区信息等。</li>
</ul>
<h3 id="2-8-消息记录（Record）"><a href="#2-8-消息记录（Record）" class="headerlink" title="2.8 消息记录（Record）"></a>2.8 消息记录（Record）</h3><ul>
<li><strong>定义</strong>：消息记录是Kafka存储和处理的基本单位</li>
<li><strong>特点</strong>：</li>
<li>每个消息记录通常包含以下几个关键部分：<ol>
<li><strong>键（Key）</strong>：这是一个可选的字段，用于消息的分区。如果消息指定了键，Kafka将根据这个键的哈希值来决定消息应该被发送到哪个分区。这对于确保具有相同键的消息能够按顺序到达并存储在同一分区中非常有用，这对于某些应用场景（如会话管理）至关重要。</li>
<li><strong>值（Value）</strong>：这是消息的实际内容，可以是任意类型的数据（如字符串、JSON对象等），具体取决于你的应用场景。值字段是消息记录的主体部分，包含了实际需要传递的信息。</li>
<li><strong>时间戳（Timestamp）</strong>：时间戳是消息被创建或记录的时间。Kafka会自动为每条消息记录分配一个时间戳，这对于后续的数据处理（如基于时间的窗口操作）和日志管理非常有用。</li>
<li><strong>偏移量（Offset）</strong>：每个分区中的消息记录都有一个唯一的偏移量标识。偏移量是消息在分区中的顺序号，用于Kafka消费者定位并读取消息。每当有新的消息被写入分区时，它的偏移量就会递增。</li>
<li><strong>头部（Headers）</strong>：Kafka消息还支持可选的头部信息，这是一个从字符串键到字节数组的映射。头部信息可以用于传递元数据或额外的上下文信息，而不会干扰消息的实际内容。</li>
</ol>
</li>
</ul>
<h2 id="3-数据流转过程"><a href="#3-数据流转过程" class="headerlink" title="3. 数据流转过程"></a>3. 数据流转过程</h2><h3 id="3-1-数据产生-amp-推送"><a href="#3-1-数据产生-amp-推送" class="headerlink" title="3.1 数据产生&amp;推送"></a>3.1 数据产生&amp;推送</h3><blockquote>
<p> 数据由生产者应用产生，通常情况下会在kafka中提前创建好topic，生产者推送数据到kafka时会将消息记录发送到指定的topic中。</p>
<p>在kafka分布式集群中，topic下还有broker、分区、副本等机制，那么数据会推送到哪里呢？</p>
</blockquote>
<ol>
<li><p>首先，topic无需选择，因为消息会发送到指定topic。</p>
</li>
<li><p>然后，选择分区partition，通常基于以下规则：</p>
</li>
</ol>
<ul>
<li><p>使用分区策略：</p>
<ul>
<li><strong>轮询策略</strong>：这是默认的分区策略，能够保证消息最大限度地被平均分配到所有分区。即如果topic有N个分区，那么第1条消息被发送到第1个分区，第2条消息被发送到第2个分区，以此类推，直到第N条消息被发送到第N个分区，然后又从头开始循环。</li>
<li><strong>按消息键保序策略</strong>：如果生产者为消息指定了key，那么Kafka会根据key的hash值来计算分区号，确保具有相同key的消息被发送到同一个分区，从而保持消息的顺序性。</li>
<li><del>随机策略：已废弃</del></li>
</ul>
</li>
<li><p>指定分区号：如果生产者在发送消息时直接指定了分区号，那么Kafka会直接将消息发送到指定的分区。</p>
</li>
</ul>
<ol start="3">
<li>选择broker：</li>
</ol>
<ul>
<li><strong>Leader副本</strong>：在Kafka中，每个分区都会有一个或多个副本（Replica），其中一个是Leader副本，负责处理读写请求。生产者发送的消息会被推送到该分区的Leader副本所在的broker。</li>
<li><strong>副本分配</strong>：Kafka会根据一定的算法将分区的副本分配到不同的broker上，以确保数据的可靠性和可用性。通常，这个算法会尽量保证每个broker上的负载均衡，并且会尽量将不同分区的Leader副本分散到不同的broker上。</li>
</ul>
<h3 id="3-2-borker消息代理"><a href="#3-2-borker消息代理" class="headerlink" title="3.2 borker消息代理"></a>3.2 borker消息代理</h3><img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/image-20240807161855792.png" class="" title="image-20240807161855792">

<p>消息进入kafka进群后，由集群中的broker进行消息代理，同一分区的leader和follower，在默认的分配策略下，leader和副本会尽量跨broker分布在不同的broker中，使每个broker中的leader和broker数量大致相等，以增加容错性，避免单节点故障带来影响，并分散处理请求的负载。</p>
<h2 id="4-kafka消息模型"><a href="#4-kafka消息模型" class="headerlink" title="4. kafka消息模型"></a>4. kafka消息模型</h2><h3 id="4-0-消费者消费原则"><a href="#4-0-消费者消费原则" class="headerlink" title="4.0 消费者消费原则"></a>4.0 消费者消费原则</h3><img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/image-20240807165500221.png" class="" title="image-20240807165500221">

<ul>
<li>分区是最小的并行单位</li>
<li>一个消费者可以消费多个分区</li>
<li>一个分区可以被多个消费者组里的消费者消费</li>
<li>一个分区不能同时被同一个消费者组里的多个消费者消费，这是处于提高性能减少开销的考虑，避免为了处理同时消费要维护的锁机制和其他额外开销。</li>
</ul>
<h3 id="4-1-点对点模式"><a href="#4-1-点对点模式" class="headerlink" title="4.1 点对点模式"></a>4.1 点对点模式</h3><img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/image-20240807170857632.png" class="" title="image-20240807170857632">

<p><strong>特点</strong>：</p>
<ul>
<li>点对点模式是一种一对一的消息传递模式。</li>
<li>消息生产者将消息发送给特定的消费者，而不是发布到一个主题。</li>
<li>消息只能被一个消费者接收和处理，即使有多个消费者监听同一个队列，也只有一个消费者能获取到该消息。</li>
<li>在Kafka中，可以通过创建单个消费者组，并设置消费者组的消费者数量为1来模拟点对点模式，但实际上Kafka更偏向于发布订阅模式。</li>
</ul>
<p><strong>应用场景</strong>：</p>
<ul>
<li>需要确保消息被特定消费者接收的场景，如任务分配、订单处理等。</li>
<li>消息传递过程中需要保持消息顺序的场景，因为点对点模式可以保证消息的顺序性。</li>
</ul>
<h3 id="4-2-发布订阅模式"><a href="#4-2-发布订阅模式" class="headerlink" title="4.2 发布订阅模式"></a>4.2 发布订阅模式</h3><img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/image-20240807170102587.png" class="" title="image-20240807170102587">

<p><strong>特点</strong>：</p>
<ul>
<li>发布订阅模式是一种一对多的消息传递模式。</li>
<li>消息生产者将消息发送到一个或多个主题（Topic），而订阅者可以选择订阅一个或多个主题来接收消息。</li>
<li>每个订阅者都可以独立地消费消息，而发布者和订阅者之间没有直接的联系。</li>
<li>消息一旦被发布到某个主题，所有订阅了该主题的消费者都可以接收到该消息。</li>
</ul>
<p>如果需要所有消费者都可以订阅同一个分区数据，可以将每个消费者放在不同的消费者组中。</p>
<p><strong>应用场景</strong>：</p>
<ul>
<li>需要广播消息给多个消费者的场景，如新闻推送、系统通知等。</li>
<li>解耦消息生产者和消费者的场景，生产者和消费者之间不需要知道对方的存在，只需要关注主题即可。</li>
</ul>
<h3 id="4-3-分区与消息顺序"><a href="#4-3-分区与消息顺序" class="headerlink" title="4.3 分区与消息顺序"></a>4.3 分区与消息顺序</h3><img src="/%E6%B5%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/kafka/1.%20kafka%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/image-20240807171523575.png" class="" title="image-20240807171523575">

<ul>
<li>同一个生产者发送到同一分区的消息，先发送的offset比后发送的offset小</li>
<li>同一个生产者发送到不同分的消息，消息顺序无法保证</li>
<li>消费者按照消息在分区里的存放顺序进行消费, 如果消费者订阅了多个分区，同一分区里的数据不一定是连续消费的，但消费顺序是确定的，即图中对于column1，partition0消费顺序一定是M1&gt;M2&gt;M3, 实际消费可能是M1-&gt;M4-&gt;M2-&gt;M3</li>
<li>kafka只保证分区内的消息顺序，不能保证分区间的消息顺序</li>
</ul>
<h3 id="4-4-消息传递语义"><a href="#4-4-消息传递语义" class="headerlink" title="4.4 消息传递语义"></a>4.4 消息传递语义</h3><p>生产者向broker发送消息后，broker接收确认后，会返回一条确认消息。</p>
<p>kafka内部有一个特殊的topic：<code>__consumer_offset</code>，负责存储消费者的消费位置，消费者在消费时需要提交消费位置来更新这个topic中的offset内容。</p>
<ul>
<li><p>最多一次：消息可能丢失，但永远不会重复发送&#x2F;消费</p>
<ul>
<li><p>生产者</p>
<p>生产者发送消息后，无论消息发送成功与否，不再重新发送</p>
</li>
<li><p>消费者</p>
<p>消费者先提交消费位置，再读取消费信息。如果在读取消费信息时失败，下一次消费时，由于刚刚已提交消费位置，这次消息将被跳过。</p>
</li>
</ul>
</li>
<li><p>最少一次：消息不会丢失，但可能会重复发送&#x2F;消费</p>
<ul>
<li><p>生产者</p>
<p>生产者发送消息后，broker成功接收到消息，但是broker返回给生产者的确认消息在传递过程中失败了，这是producer会再次发送该消息，导致重复发送</p>
</li>
<li><p>消费者</p>
<p>消费者先读取消费信息，再提交消费位置，但提交消费位置时失败了，这将导致下一次消费时再次读取这条消息，即重复消费。</p>
</li>
</ul>
</li>
<li><p>精确一次：保证消息被传递到服务端且在服务端不重复</p>
<p>实现比较困难</p>
</li>
</ul>
<h2 id="5-生产者API"><a href="#5-生产者API" class="headerlink" title="5. 生产者API"></a>5. 生产者API</h2><h2 id="6-消费者API"><a href="#6-消费者API" class="headerlink" title="6. 消费者API"></a>6. 消费者API</h2><h2 id="7-序列化"><a href="#7-序列化" class="headerlink" title="7. 序列化"></a>7. 序列化</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/4.%20ElasticSearch%20Query%20DSL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/4.%20ElasticSearch%20Query%20DSL/" class="post-title-link" itemprop="url">4. ElasticSearch Query DSL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-18 15:23:54" itemprop="dateCreated datePublished" datetime="2024-07-18T15:23:54+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-26 19:17:10" itemprop="dateModified" datetime="2024-11-26T19:17:10+08:00">2024-11-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>29 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="4-ElasticSearch-Query-DSL"><a href="#4-ElasticSearch-Query-DSL" class="headerlink" title="4. ElasticSearch Query DSL"></a>4. ElasticSearch Query DSL</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><p>ElasticSearch的查询语法DSL（Domain Specific Language）实质上是发起一个HTTP请求，查询语法以JSON格式书写，并放在请求的请求体中。</p>
<p>即通过 HTTP+JSON 的方式即可完成对ElasticSearch的操作。</p>
<p><strong>在ElasticSearch中，建议先建立索引和映射，然后再向索引中写入数据。</strong></p>
<h2 id="2-索引操作"><a href="#2-索引操作" class="headerlink" title="2. 索引操作"></a>2. 索引操作</h2><blockquote>
<p>以下所有操作通过Kibana测试工具进行，由于Kibana和ES时高度集成的，一般都部署在同一网络中，所以通过Kibana进行操作时，HTTP请求的URL路径中可以忽略服务器信息（域名或ip地址等）</p>
</blockquote>
<h3 id="2-1-创建索引"><a href="#2-1-创建索引" class="headerlink" title="2.1 创建索引"></a>2.1 创建索引</h3><blockquote>
<p>创建索引，相当于在关系型数据库中创建数据库</p>
</blockquote>
<p>创建一个名为<code>index_zky</code>的索引：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /index_zky</span><br></pre></td></tr></table></figure>

<img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/4.%20ElasticSearch%20Query%20DSL/image-20240719102601483.png" class="" title="image-20240719102601483">

<p>可以看到，响应结果表明：</p>
<ul>
<li>创建索引的请求已经被集群中的主节点接收并认可</li>
<li>索引的分片请求已经被足量的分片接收并认可</li>
<li>索引名为：index_zky</li>
</ul>
<blockquote>
<p>为什么使用PUT方法？</p>
<p>PUT方法用于更新，或在某些情况下创建资源。且PUT请求时幂等的，即多次请求同一个URL，返回结果应该是一样的。多次请求创建同一个索引，ES在第二次后会忽略请求，返回索引已经存在的提示。但索引的状态没有发生改变，这是符合幂等性的。</p>
<p>在ES中，创建索引只能使用PUT请求。</p>
</blockquote>
<p>再次尝试创建该索引：</p>
<img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/4.%20ElasticSearch%20Query%20DSL/image-20240719104055988.png" class="" title="image-20240719104055988">

<h3 id="2-2-查询索引"><a href="#2-2-查询索引" class="headerlink" title="2.2 查询索引"></a>2.2 查询索引</h3><ul>
<li><p>查询指定索引信息</p>
<p>查询名为<code>index_zky</code>的索引的信息：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky</span><br></pre></td></tr></table></figure>

<p>响应：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index_zky&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;routing&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;allocation&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;include&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;_tier_preference&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;data_content&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;search&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;slowlog&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;level&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;info&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;threshold&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;fetch&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;warn&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;200ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;trace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;50ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;debug&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;80ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;100ms&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;query&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;warn&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;500ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;trace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;50ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;debug&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;100ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;200ms&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;refresh_interval&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10s&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;indexing&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;slowlog&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;level&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;info&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;threshold&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;warn&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;200ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;trace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;20ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;debug&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;50ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;info&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;100ms&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;source&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1000&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;provided_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;index_zky&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;creation_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1721355853799&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;unassigned&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;node_left&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;delayed_timeout&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;5m&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;oS-SNjsDRKCKdExevJDkQg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;created&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7100099&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>含义（来自于GPT ）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">aliases</span><br><span class="line">    值：&#123; &#125;</span><br><span class="line">    含义：这个索引没有设置别名。别名允许你通过不同的名称来引用同一个索引，这在某些场景下非常有用，比如在不中断服务的情况下重新索引数据。</span><br><span class="line">mappings</span><br><span class="line">    值：&#123; &#125;</span><br><span class="line">    含义：这里映射部分为空，可能是因为查询没有包含具体的字段映射信息，或者该索引尚未定义任何字段映射。在Elasticsearch中，映射定义了索引中文档的结构，包括字段的名称、类型以及如何处理这些字段的索引和搜索。</span><br><span class="line">settings</span><br><span class="line">    index.routing.allocation.include._tier_preference</span><br><span class="line">        值：&quot;data_content&quot;</span><br><span class="line">        含义：这指定了索引的分片应该被分配到哪些节点上。在这个例子中，它表明分片应该被分配到标记为data_content的数据层节点上。这是一种节点选择策略，用于优化索引的性能和可用性。</span><br><span class="line">    search.slowlog</span><br><span class="line">        level：&quot;info&quot;</span><br><span class="line">        threshold：定义了不同日志级别（info, debug, warn, trace）的慢查询阈值。例如，对于查询日志（query），信息级别（info）的阈值被设置为200ms，意味着执行时间超过200ms的查询将被记录为信息级别的日志。</span><br><span class="line">    refresh_interval</span><br><span class="line">        值：&quot;10s&quot;</span><br><span class="line">        含义：这定义了索引的刷新间隔，即Elasticsearch多久会将内存中的更改刷新到磁盘上的索引文件中。较短的刷新间隔可以提供更快的近实时搜索能力，但会增加磁盘I/O和索引的压力。</span><br><span class="line">    indexing.slowlog</span><br><span class="line">        level：&quot;info&quot;</span><br><span class="line">        threshold：定义了索引操作（如文档索引）的慢日志阈值。例如，对于索引操作，信息级别的阈值被设置为100ms。</span><br><span class="line">        source：&quot;1000&quot;，这可能指的是与慢日志相关的某个特定设置，但具体含义可能因Elasticsearch版本而异。在某些版本中，这个值可能与慢日志记录的源文档数量或大小有关。</span><br><span class="line">    number_of_shards</span><br><span class="line">        值：&quot;1&quot;</span><br><span class="line">        含义：这个索引被分成了1个分片。分片是Elasticsearch分布式存储和搜索机制的基础，它们允许索引数据跨多个节点进行分配，从而提高性能和可扩展性。</span><br><span class="line">    number_of_replicas</span><br><span class="line">        值：&quot;1&quot;</span><br><span class="line">        含义：这个索引有1个副本。副本是分片的额外拷贝，用于提供数据的冗余和容错能力。在这个例子中，每个分片都有一个副本，这意味着如果原始分片所在的节点发生故障，副本可以接管并提供数据的访问。</span><br><span class="line">    provided_name</span><br><span class="line">        值：&quot;index_zky&quot;</span><br><span class="line">        含义：这是创建索引时提供的名称。</span><br><span class="line">    creation_date</span><br><span class="line">        值：&quot;1721355853799&quot;</span><br><span class="line">        含义：这是索引的创建时间戳，表示索引在Elasticsearch集群中被创建的具体时间。</span><br><span class="line">    unassigned.node_left.delayed_timeout</span><br><span class="line">        值：&quot;5m&quot;</span><br><span class="line">        含义：这定义了当一个节点离开集群时，其上的分片被标记为未分配状态的延迟超时时间。在这个例子中，如果节点离开集群，其上的分片将在5分钟后被标记为未分配状态，以便集群可以重新平衡分片到其他节点上。</span><br><span class="line">    uuid</span><br><span class="line">        值：&quot;oS-SNjsDRKCKdExevJDkQg&quot;</span><br><span class="line">        含义：这是索引的唯一标识符。</span><br><span class="line">    version.created</span><br><span class="line">        值：&quot;7100099&quot;</span><br><span class="line">        含义：这表示创建索引时使用的Elasticsearch的内部版本号。这个数字可以帮助你了解索引是在哪个版本的Elasticsearch上创建的，尽管它并不直接对应于Elasticsearch的发布版本号。</span><br></pre></td></tr></table></figure>


</li>
<li><p>查询所有索引信息</p>
<p>查看集群中的所有索引信息：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v</span><br></pre></td></tr></table></figure>

<p>命令解析：</p>
<ul>
<li>_cat：这是ElasticSearch的一个API，用于获取集群的各类信息，如索引、节点、健康状态等</li>
<li>indicies: 这是_cat API 的一个特定端点，用于列出集群中的所有索引</li>
<li>v: ?后面的内容是URL中的查询字符串部分，<code>v</code>参数是一个常见的选项，用于以“详细”或“垂直”格式输出信息。这种格式通常包括更多的列，并且每列数据都垂直排列，使得输出更易于阅读。如果没有<code>?v</code>参数，输出可能会更加紧凑，只包含最基本的信息。</li>
</ul>
<p>响应结果：</p>
<img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/4.%20ElasticSearch%20Query%20DSL/image-20240719110018257.png" class="" title="image-20240719110018257">

<p>响应结果解析：</p>
<ul>
<li><p><code>health</code>：</p>
<p>健康状态可以是<code>green</code>（一切正常，所有副本都已分配并可用）、<code>yellow</code>（所有主分片都可用，但一个或多个副本分片不可用或未分配）或<code>red</code>（一个或多个主分片不可用）。</p>
</li>
<li><p><code>status</code>：这个字段通常与<code>health</code>字段相似</p>
</li>
<li><p><code>index</code>：索引名</p>
</li>
<li><p><code>uuid</code>：<br>这是索引的唯一标识符（UUID），用于在Elasticsearch集群中唯一地标识索引。它与索引名称不同，因为索引名称可能在不同的集群或命名空间中重复，但UUID是全局唯一的。</p>
</li>
<li><p><code>pri</code>：<br>这个字段表示索引的主分片（primary shard）数量。主分片是负责存储索引数据并处理与该索引相关的读写操作的分片。</p>
</li>
<li><p><code>rep</code>：<br>这个字段表示索引的副本分片（replica shard）数量。副本分片是主分片的复制，用于提供数据的冗余和容错能力。如果主分片所在的节点发生故障，副本分片可以接管并提供数据的访问。</p>
</li>
<li><p><code>docs.count</code>：这个字段表示索引中存储的文档总数。</p>
</li>
<li><p><code>docs.deleted</code>：<br>这个字段表示索引中已被标记为删除但尚未从磁盘上物理删除的文档数量。在Elasticsearch中，文档删除是逻辑上的，即它们被标记为已删除，但在物理上可能仍然存在于磁盘上，直到后台合并过程将它们从磁盘上清除。</p>
</li>
<li><p><code>store.size</code>：<br>这个字段表示索引在磁盘上占用的总空间大小（不包括副本分片）。它反映了索引数据、索引结构以及可能的其他元数据的总大小。</p>
</li>
<li><p><code>pri.store.size</code>：<br>这个字段表示索引的主分片在磁盘上占用的空间大小。与<code>store.size</code>不同，它只考虑主分片，而不包括副本分片。</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-3-删除索引"><a href="#2-3-删除索引" class="headerlink" title="2.3 删除索引"></a>2.3 删除索引</h3><p>删除指定索引：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /index_zky</span><br></pre></td></tr></table></figure>



<h2 id="3-文档操作"><a href="#3-文档操作" class="headerlink" title="3. 文档操作"></a>3. 文档操作</h2><h3 id="3-1-创建文档"><a href="#3-1-创建文档" class="headerlink" title="3.1 创建文档"></a>3.1 创建文档</h3><ul>
<li><p>POST方法创建</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /index_zky/_doc</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;xiao zhang&quot;,</span><br><span class="line">  &quot;age&quot;:18,</span><br><span class="line">  &quot;sex&quot;:&quot;男&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;index_zky&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_eqqyZABYVRWZibKx-9Y&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这种创建数据的方式只能使用POST请求，返回结果中的id字段是随机生成的，多次触发该请求，响应的结果是不同的，相当与创建了多个文档，即这个操作是非幂等性的，因此只能使用POST请求不能使用PUT请求。</p>
</blockquote>
<blockquote>
<p>_doc API : ElasticSearch中的<code>_doc</code> API 主要与文档的增、删、改、查等操作相关，但并不直接作为一个独立的API存在，而是作为文档操作API中的一个关键组成部分。在ElasticSearch中，文档是存储和索引的基本单位，而<code>_doc</code>通常用于指定文档操作的具体路径或类型（在ElasticSearch 7.x及以后版本中，默认的类型名就是<code>_doc</code>）</p>
</blockquote>
</li>
<li><p>PUT方法创建</p>
<ul>
<li><p>_doc<br>创建一个id为001的文档</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /index_zky/_doc/001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;xiao ming&quot;,</span><br><span class="line">  &quot;age&quot;:18,</span><br><span class="line">  &quot;sex&quot;:&quot;男&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>响应结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;index_zky&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;001&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看到，响应结果里的id正是创建文档时指定的001，这样，这个请求无论进行多少次，结果都是相同的。即该请求是幂等的，可以使用PUT请求。</p>
</blockquote>
</li>
<li><p>_create<br>同上，创建数据也可以使用<code>_create</code>接口：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /index_zky/_create/001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;xiao ming&quot;,</span><br><span class="line">  &quot;age&quot;:18,</span><br><span class="line">  &quot;sex&quot;:&quot;男&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="3-2-查询文档"><a href="#3-2-查询文档" class="headerlink" title="3.2 查询文档"></a>3.2 查询文档</h3><ul>
<li>查询索引下指定id的数据<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_doc/001</span><br></pre></td></tr></table></figure>

响应结果：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;index_zky&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;001&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;xiao ming&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;男&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>查询索引下所有数据<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-3-修改文档"><a href="#3-3-修改文档" class="headerlink" title="3.3 修改文档"></a>3.3 修改文档</h3><ul>
<li><p>全量修改<br>全量修改是覆盖性修改，操作是幂等性的，可通过PUT请求实现：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /index_zky/_doc/001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;xiao ming&quot;,</span><br><span class="line">  &quot;age&quot;:28, #年龄改成28</span><br><span class="line">  &quot;sex&quot;:&quot;男&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>局部修改</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /index_zky/_update/001</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;: &#123;</span><br><span class="line">    &quot;age&quot;:&quot;19&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ElasticSearch在内部通过增加文档的版本号（version）来处理更新，将旧文档标记为删除，并添加一个包含更新内容的新文档。这意味着，每次局部更新都会生成一个新的文档版本。</p>
<p>由于局部更新只修改文档的一部分，且可能受到其他并发操作的影响（如其他客户端同时也在更新同一文档），因此多次执行相同的局部更新请求可能会得到不同的结果（例如，文档的版本号会增加，而其他字段可能因并发操作而发生变化）</p>
<p>即结果是非幂等的，采用POST请求。</p>
</blockquote>
</li>
</ul>
<h3 id="3-4-删除文档"><a href="#3-4-删除文档" class="headerlink" title="3.4 删除文档"></a>3.4 删除文档</h3><ul>
<li><p>删除指定文档</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /index_zky/_doc/001</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-复杂的查询操作"><a href="#4-复杂的查询操作" class="headerlink" title="4. 复杂的查询操作"></a>4. 复杂的查询操作</h2><h3 id="4-1-条件查询"><a href="#4-1-条件查询" class="headerlink" title="4.1 条件查询"></a>4.1 条件查询</h3><ul>
<li><p>通过url进行条件过滤（非常少用）</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://域名：端口号/索引名/_search?q=字段名：字段值</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询条件在请求体中（常用）</p>
<ul>
<li><p>单条件查询：查询age为18的数据</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match&quot;:&#123;</span><br><span class="line">			&quot;age&quot;:18</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>全量查询：不限制条件</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_all&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="4-2-分页查询"><a href="#4-2-分页查询" class="headerlink" title="4.2 分页查询"></a>4.2 分页查询</h3><p>  分页查询，每页两条，查询第一页数据：</p>
  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_all&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;from&quot; : 0,</span><br><span class="line">	&quot;size&quot; : 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  from: 从哪条数据开始，</p>
<blockquote>
<p>计算公式 ：（页码-1）*每页数据条数<br>比如每页数据有两条，想看第二页的数据，那么起始值from&#x3D;（2-1）*2 &#x3D; 2</p>
</blockquote>
<p>  size：每页显示的数据条数</p>
<h3 id="4-3-查询指定字段"><a href="#4-3-查询指定字段" class="headerlink" title="4.3 查询指定字段"></a>4.3 查询指定字段</h3><p>例如只查询name字段：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_all&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;_source&quot; : [&quot;name&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>返回的数据结果_source中，只会包含name字段的信息</p>
</blockquote>
<h3 id="4-4-查询排序"><a href="#4-4-查询排序" class="headerlink" title="4.4 查询排序"></a>4.4 查询排序</h3><p>对查询结果按照指定字段（如age）排序：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_all&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;sort&quot;:&#123;</span><br><span class="line">		&quot;age&quot;:&#123;</span><br><span class="line">			&quot;order&quot;:&quot;desc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-多条件查询"><a href="#4-5-多条件查询" class="headerlink" title="4.5 多条件查询"></a>4.5 多条件查询</h3><p>多个查询条件，结合逻辑表达式使用：</p>
<p>逻辑表达式：</p>
<blockquote>
<p>must :类似于sql中的and语义，表示条件必须同时成立<br>should:类似于sql中的or语义，表示任意一个条件成立即可<br>not must：类似于sql中的not语义，表示条件不成立</p>
</blockquote>
<p>查询名字为小张，且年龄为18的数据:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;bool&quot;:&#123;</span><br><span class="line">			&quot;must&quot;:[</span><br><span class="line">				&#123;</span><br><span class="line">					&quot;match&quot;:&#123;</span><br><span class="line">						&quot;name&quot;:&quot;xiao zhang&quot;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					&quot;match&quot;:&#123;</span><br><span class="line">						&quot;age&quot;:18</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-范围查询"><a href="#4-6-范围查询" class="headerlink" title="4.6 范围查询"></a>4.6 范围查询</h3><p>类似于sql中的非等值查询</p>
<p>查询年龄大于15的数据：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_all&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;filter&quot;:&#123;</span><br><span class="line">		&quot;range&quot;:&#123;</span><br><span class="line">			&quot;price&quot;:&#123;</span><br><span class="line">				&quot;gt&quot;:15</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>大于：gt</p>
<p>大于等于：gte</p>
<p>小于：lt</p>
<p>小于等于：lte</p>
</blockquote>
<h2 id="5-全文检索"><a href="#5-全文检索" class="headerlink" title="5. 全文检索"></a>5. 全文检索</h2><h3 id="5-1-全文检索"><a href="#5-1-全文检索" class="headerlink" title="5.1 全文检索"></a>5.1 全文检索</h3><p>对于文本类型的数据，进行匹配查询时，ES会对文本进行分词，查询条件也会被分词，然后通过倒排索引，将所有符合条件的数据全都查询出来。这类似于sql中的模糊查询。</p>
<p>例如，查询name为”xiao”的数据：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match&quot;:&#123;</span><br><span class="line">			&quot;name&quot;:&quot;xiao&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果（只展示命中数据部分）：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;index_zky&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;_eqqyZABYVRWZibKx-9Y&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.18232156,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;name&quot; : &quot;xiao zhang&quot;,</span><br><span class="line">          &quot;age&quot; : 18,</span><br><span class="line">          &quot;sex&quot; : &quot;男&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;index_zky&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;001&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.18232156,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;name&quot; : &quot;xiao ming&quot;,</span><br><span class="line">          &quot;age&quot; : &quot;19&quot;,</span><br><span class="line">          &quot;sex&quot; : &quot;男&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看到，查询是指定的name为“xiao”，但是返回结果把name中带有“xiao“这个词的数据都查询出来了，因为ES对name进行了分词。同样地，查询条件也会被分词，例如查询name：“张李”，会把name中带有”张“字和”李“字的所有数据都查出来。</p>
</blockquote>
<h3 id="5-2-完全匹配查询"><a href="#5-2-完全匹配查询" class="headerlink" title="5.2 完全匹配查询"></a>5.2 完全匹配查询</h3><p>将匹配查询的关键字<code>match</code>替换为<code>match_phrase</code>，匹配条件不会被分词，也不会通过分词方式查询数据。</p>
<h3 id="5-3-高亮查询"><a href="#5-3-高亮查询" class="headerlink" title="5.3 高亮查询"></a>5.3 高亮查询</h3><p>对查询结果高亮显示，例如对name高亮显示：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_phrse&quot;:&#123;</span><br><span class="line">			&quot;name&quot;:&quot;xiao zhang&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;highlight&quot;:&#123;</span><br><span class="line">		&quot;fields&quot;:&#123;</span><br><span class="line">			&quot;name&quot;:&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果（只展示命中部分）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;index_zky&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_eqqyZABYVRWZibKx-9Y&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">0.87546873</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;xiao zhang&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sex&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;男&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;highlight&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;&lt;em&gt;xiao&lt;/em&gt; &lt;em&gt;zhang&lt;/em&gt;&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br></pre></td></tr></table></figure>



<h2 id="6-聚合查询"><a href="#6-聚合查询" class="headerlink" title="6. 聚合查询"></a>6. 聚合查询</h2><p>聚合查询示例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /index_zky/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;aggs&quot;:&#123;  //聚合操作</span><br><span class="line">		&quot;age_count&quot;:&#123; //聚合名称，可以随意指定</span><br><span class="line">			&quot;terms&quot;:&#123; // 聚合类型，这里是分组聚合</span><br><span class="line">				&quot;field&quot;:&quot;age&quot; // 聚合字段</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;size&quot;:0 //size指定为0表示希望返回结果中不展示原始数据</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age_count&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;doc_count_error_upper_bound&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sum_other_doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>结果中可以看出，返回了每个age的值对应的文档数。</p>
<p>聚合类型还有（来源于GPT）：</p>
<ol>
<li><code>terms</code> 聚合：<ul>
<li>关键字：<code>terms</code></li>
<li>描述：用于对一组文本值进行分组统计，例如，统计某个字段的不同值的数量。</li>
</ul>
</li>
<li><code>metric</code> 聚合：<ul>
<li>关键字：虽然 <code>metric</code> 本身不是一个具体的聚合类型，但它代表了一类计算数值的聚合，如平均值、最小值、最大值、总和等。</li>
<li>具体类型包括：<code>avg</code>（平均值）、<code>min</code>（最小值）、<code>max</code>（最大值）、<code>sum</code>（总和）、<code>cardinality</code>（基数统计，用于估算不重复值的数量）等。</li>
</ul>
</li>
<li><code>bucket</code> 聚合：<ul>
<li>关键字：<code>bucket</code> 也不是一个具体的聚合类型，但它指的是将文档集合划分为多个桶（bucket）或组的聚合操作。</li>
<li>具体类型包括：<code>date_histogram</code>（按日期直方图分组）、<code>histogram</code>（按数值范围分组）、<code>range</code>（按数值范围分组，但范围由用户定义）、<code>geo_hash_grid</code>（按地理位置网格分组）等。</li>
</ul>
</li>
<li><code>pipeline</code> 聚合：<ul>
<li>关键字：<code>pipeline</code></li>
<li>描述：这些聚合是在其他聚合的结果上运行的，用于对聚合结果进行进一步的处理或计算。例如，<code>bucket_sort</code>（对桶进行排序）、<code>moving_avg</code>（计算移动平均值）、<code>cumulative_sum</code>（计算累计和）等。</li>
</ul>
</li>
<li><code>filter</code> 聚合：<ul>
<li>关键字：<code>filter</code></li>
<li>描述：用于在聚合之前应用一个过滤器来限制哪些文档被包含在聚合结果中。虽然 <code>filter</code> 聚合本身不直接计算任何指标，但它可以与其他聚合类型结合使用来提供过滤后的聚合结果。</li>
</ul>
</li>
<li><code>nested</code> 聚合：<ul>
<li>关键字：<code>nested</code></li>
<li>描述：用于对嵌套对象字段中的数据进行聚合。由于 Elasticsearch 默认将嵌套对象扁平化处理，<code>nested</code> 聚合允许你按嵌套对象的独立实例进行聚合。</li>
</ul>
</li>
<li><code>geo_distance</code> 聚合：<ul>
<li>关键字：<code>geo_distance</code></li>
<li>描述：这是一种特殊的桶聚合，用于基于地理位置点和距离范围对文档进行分组。它通常与地理位置数据一起使用。</li>
</ul>
</li>
</ol>
<p>这些聚合操作可以单独使用，也可以组合使用来构建复杂的查询和分析逻辑。</p>
<h2 id="7-映射（mapping）"><a href="#7-映射（mapping）" class="headerlink" title="7. 映射（mapping）"></a>7. 映射（mapping）</h2><blockquote>
<p>配置映射是定义索引中的文档结构和字段数据类型的过程，映射机制允许开发者精确控制数据的存储和索引方式，从而优化搜索性能，以及满足特定的业务需求。</p>
</blockquote>
<h3 id="7-1-配置映射"><a href="#7-1-配置映射" class="headerlink" title="7.1 配置映射"></a>7.1 配置映射</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT /index_zky/_mapping</span><br><span class="line">&#123;</span><br><span class="line">	&quot;properties&quot;:&#123;</span><br><span class="line">		&quot;name&quot;:&#123;</span><br><span class="line">			&quot;type&quot;:&quot;text&quot;,</span><br><span class="line">			&quot;index&quot;:true</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;age&quot;:&#123;</span><br><span class="line">			&quot;type&quot;:&quot;keyword&quot;,</span><br><span class="line">			&quot;index&quot;:false</span><br><span class="line">		&#125;</span><br><span class="line">		&quot;sex&quot;:&#123;</span><br><span class="line">			&quot;type&quot;:&quot;keyword&quot;,</span><br><span class="line">			&quot;index&quot;:true</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上映射为索引<code>index_zky</code>定义了文档接口和字段类型，<code>name</code>字段配置为text类型，表明该字段支持全文检索（模糊查询），index为true表明该字段可以被索引到；<code>age</code>字段类型配置为keyword类型，表示该字段只支持精确查询，无法被全文检索，同时index设置为false表示该字段无法被索引到。以此类推。映射中还可以配置很多其他信息。</p>
<p>映射可以配置的信息（来源于GPT）：</p>
<ol>
<li><p>字段名称（Field Names）</p>
<ul>
<li><strong>字段名</strong>：为索引中的每个字段指定一个唯一的名称。字段名可以是任意的，但通常应该能够反映字段的内容或用途。</li>
</ul>
</li>
<li><p>字段类型（Field Types）</p>
</li>
</ol>
<p>​	Elasticsearch支持多种数据类型，配置映射时需要为每个字段指定一个合适的类型。常见的字段类型包括：</p>
<ul>
<li>字符串类型：<ul>
<li><code>text</code>：用于全文搜索的文本字段，会被分词器处理。</li>
<li><code>keyword</code>：用于精确值匹配的文本字段，不会被分词。</li>
</ul>
</li>
<li>数值类型：<ul>
<li><code>long</code>、<code>integer</code>、<code>short</code>、<code>byte</code>、<code>double</code>、<code>float</code>、<code>half_float</code>、<code>scaled_float</code>：用于存储数值数据。</li>
</ul>
</li>
<li><strong>日期类型</strong>（<code>date</code>）：用于存储日期和时间。</li>
<li><strong>布尔类型</strong>（<code>boolean</code>）：用于存储布尔值（true或false）。</li>
<li><strong>二进制类型</strong>（<code>binary</code>）：用于存储二进制数据，如图片、PDF文件等。</li>
<li><strong>范围类型</strong>：用于存储数值范围，如整数范围、浮点数范围等。</li>
<li>复合类型：<ul>
<li><strong>数组</strong>（<code>array</code>）：用于存储字段值的数组。</li>
<li><strong>对象</strong>（<code>object</code>）：用于存储嵌套的对象。</li>
</ul>
</li>
</ul>
<ol start="3">
<li>索引选项（Indexing Options）</li>
</ol>
<ul>
<li><strong>是否索引</strong>（<code>index</code>）：指定字段是否应该被索引。默认为<code>true</code>，表示字段会被索引并可用于搜索。如果设置为<code>false</code>，则字段不会被索引，不能用于搜索。</li>
<li><strong>存储选项</strong>（<code>store</code>）：指定字段的原始值是否应该被独立存储。默认为<code>false</code>，表示字段值不会独立存储，而是从<code>_source</code>字段中提取。如果设置为<code>true</code>，则字段的原始值会被独立存储，这可以提高检索效率但会增加存储空间。</li>
</ul>
<ol start="4">
<li>分析器（Analyzer）</li>
</ol>
<p>​	对于<code>text</code>类型的字段，可以指定一个分析器（Analyzer）来控制文本的分词和索引方式。Elasticsearch提供了多种内置分析器，也可以自定义分析器。</p>
<ol start="5">
<li>其他映射参数</li>
</ol>
<p>​	除了上述基本信息外，还可以配置其他映射参数来满足特定的需求，例如：</p>
<ul>
<li>**<code>ignore_above</code>**：指定一个长度阈值，超过该长度的字段值将被忽略。</li>
<li>**<code>null_value</code>**：为字段指定一个默认值，当字段值为null时，将使用此默认值进行索引和搜索。</li>
<li>**<code>properties</code>**：对于复合类型（如对象）的字段，可以在<code>properties</code>下指定嵌套字段的映射信息。</li>
</ul>
<h3 id="7-2-动态映射"><a href="#7-2-动态映射" class="headerlink" title="7.2 动态映射"></a>7.2 动态映射</h3><h4 id="7-2-1-概念"><a href="#7-2-1-概念" class="headerlink" title="7.2.1 概念"></a>7.2.1 概念</h4><p>动态映射是ElasticSearch自动推断和创建字段类型的过程。当索引中插入新文档时，如果文档包含了映射中尚未定义的新字段，ElasticSearch会根据字段的值自动推断其类型并将其添加到映射中。</p>
<h4 id="7-2-2-特点"><a href="#7-2-2-特点" class="headerlink" title="7.2.2 特点"></a>7.2.2 特点</h4><ol>
<li>方便快捷：<ul>
<li>无需提前定义所有字段类型，减少了开发和配置的工作量。</li>
<li>适用于数据结构不固定或变化频繁的场景，如日志分析、社交媒体数据采集等。</li>
</ul>
</li>
<li>适应性强：<ul>
<li>能够自动适应新字段的加入，无需手动修改映射配置。</li>
</ul>
</li>
<li>不精确性：<ul>
<li>自动推断的类型可能不完全符合预期，例如字符串类型的日期被推断为文本类型。</li>
</ul>
</li>
<li>风险控制：<ul>
<li>在高并发写入时可能会引起映射爆炸（Mapping Explosion）问题，导致内存和性能问题。</li>
<li>映射变化可能会影响查询性能和结果的准确性。</li>
</ul>
</li>
</ol>
<h4 id="7-2-3-配置"><a href="#7-2-3-配置" class="headerlink" title="7.2.3 配置"></a>7.2.3 配置</h4><ol>
<li>启用&#x2F;禁用动态映射：<ul>
<li>可以通过设置<code>dynamic</code>参数来控制是否启用动态映射。<code>dynamic</code>参数可以设置为<code>true</code>（默认）、<code>false</code>（忽略新字段）、<code>strict</code>（遇到未知字段时抛出异常）或<code>runtime</code>（动态创建运行时字段）。</li>
</ul>
</li>
<li>日期检测：<ul>
<li>如果启用了日期检测（<code>date_detection</code>），ElasticSearch会检查新的字符串字段，以查看其内容是否匹配<code>dynamic_date_formats</code>中指定的任何日期模式。如果匹配，则将该字段映射为日期类型。</li>
</ul>
</li>
<li>数字检测：<ul>
<li>通过设置<code>numeric_detection</code>参数，可以启用数字检测。如果启用了此功能，ElasticSearch会尝试将看起来像数字的字符串字段映射为数值类型。</li>
</ul>
</li>
<li>动态模板：<ul>
<li>动态模板（Dynamic Templates）允许用户定义自定义的映射规则，这些规则可以基于匹配条件应用于动态添加的字段。通过动态模板，可以更精细地控制字段的映射行为。</li>
</ul>
</li>
</ol>
<h4 id="7-2-4-适用场景"><a href="#7-2-4-适用场景" class="headerlink" title="7.2.4 适用场景"></a>7.2.4 适用场景</h4><ul>
<li><strong>数据结构不固定或频繁变化的应用</strong>：如日志分析、社交媒体数据采集等。</li>
<li><strong>开发阶段或快速原型设计时</strong>：用于快速验证数据模型。</li>
</ul>
<h3 id="7-3-关于映射的疑问"><a href="#7-3-关于映射的疑问" class="headerlink" title="7.3 关于映射的疑问"></a>7.3 关于映射的疑问</h3><ul>
<li><p>ElasticSearch 7.x 版本已经删除了类型（type）的概念，为什么映射中还需要配置type？</p>
<blockquote>
<p>首先要明确两个type的不同。</p>
<p>7.x版本删除的type，是<code>_type</code>接口，这是用来表示被索引的文档或实体的类型，在之前版本中，每个索引可以包含多个<code>_type</code>，每个<code>_type</code>代表一种具有特定字段结构的文档类型。在7.x 版本以后，所有的文档类型都被统一为<code>_doc</code>。</p>
<p>映射中配置的type，是指字段的数据类型。它定义了索引中文档字段的存储方式和数据类型。</p>
</blockquote>
</li>
<li><p>如果先向索引中写入了数据，然后才建立映射，会产生什么影响？</p>
<blockquote>
<ol>
<li>默认数据类型和设置：<ul>
<li>Elasticsearch会根据字段的值自动推断数据类型。例如，如果字段包含文本数据，它可能会被推断为<code>text</code>类型，并使用默认的分析器（如<code>standard</code>分析器）进行分词。</li>
<li>对于一些复杂的数据类型（如嵌套对象、地理位置等），如果没有在映射中明确指定，Elasticsearch可能无法正确存储或查询这些数据。</li>
</ul>
</li>
<li>性能影响：<ul>
<li>在数据写入后建立映射可能会导致性能下降，因为Elasticsearch需要在写入数据时动态地调整和优化索引结构。</li>
<li>特别是当大量数据已经写入时，修改映射（尤其是添加新字段或更改字段类型）可能会变得复杂且耗时，甚至需要重建索引。</li>
</ul>
</li>
<li>查询和聚合的限制：<ul>
<li>默认情况下，Elasticsearch可能不会为所有字段启用索引或存储设置，这可能会影响查询和聚合操作的性能。</li>
<li>如果需要对特定字段进行精确匹配查询、全文搜索、排序或聚合，最好在映射中明确指定这些字段的设置。</li>
</ul>
</li>
<li>数据一致性和准确性：<ul>
<li>自动推断的映射可能无法准确反映数据的实际结构和业务需求。</li>
<li>例如，如果某个字段本应包含精确的日期信息，但由于自动推断错误而被视为文本类型，那么在进行日期范围查询时可能会出现问题。</li>
</ul>
</li>
<li>安全性：<ul>
<li>自动映射可能会暴露数据的敏感信息或结构，如果这些信息在映射中未得到妥善保护。</li>
</ul>
</li>
</ol>
</blockquote>
</li>
</ul>
<p><strong>在ElasticSearch中，建议先建立索引和映射，然后再向索引中写入数据。</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/3.%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/3.%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">3. 分布式集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-18 14:17:03" itemprop="dateCreated datePublished" datetime="2024-07-18T14:17:03+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-20 13:10:31" itemprop="dateModified" datetime="2024-11-20T13:10:31+08:00">2024-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>599</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="3-分布式集群"><a href="#3-分布式集群" class="headerlink" title="3. 分布式集群"></a>3. 分布式集群</h1><h2 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1. 基本概念"></a>1. 基本概念</h2><h3 id="1-1-集群-cluster"><a href="#1-1-集群-cluster" class="headerlink" title="1.1 集群(cluster)"></a>1.1 集群(cluster)</h3><p>集群是一个或多个节点的结合，这些节点将共同拥有完整的数据，并跨节点提供联合索引、搜索和分析功能。集群由唯一的名称进行标识，节点只能通过集群名称加入集群。</p>
<h3 id="1-2-节点-node"><a href="#1-2-节点-node" class="headerlink" title="1.2 节点(node)"></a>1.2 节点(node)</h3><p>节点是一个ElasticSearch的运行实例，也就是一个进程，多个节点组成集群。节点存储数据，并参与集群的索引、搜索和分析功能。节点也由一个名称标识。</p>
<h3 id="1-3-分片-shard"><a href="#1-3-分片-shard" class="headerlink" title="1.3 分片(shard)"></a>1.3 分片(shard)</h3><blockquote>
<p> 索引存储的数据可能会超过单个节点的硬件限制。分片的出现就是为了解决这个问题。创建索引时可以定义分片的数量，分片可以分布在集群的任何节点上。</p>
</blockquote>
<p>分片是对索引数据的水平拆分，即索引的所有分片数据，构成了该索引存储的所有数据。</p>
<p>可以跨分片进行分发和并行操作，提高性能和吞吐量。</p>
<h3 id="1-4-副本-replica"><a href="#1-4-副本-replica" class="headerlink" title="1.4 副本(replica)"></a>1.4 副本(replica)</h3><blockquote>
<p> 为了在节点或分片发生故障时提供高可用性，提出了副本的概念。</p>
</blockquote>
<p>副本是对索引分片的拷贝，可以有一个或多个。副本不会分配到复制它的主分片所在的节点上，即分片和对应的副本不会在同一个节点上，避免节点机器故障时无法容错。</p>
<p>副本机制可以提高搜索性能和水平扩展吞吐量，因为可以在所有副本上并行执行搜索。</p>
<p>可以在创建索引时为每个索引定义分片和副本的数量。创建索引后，可以随时动态更改副本的数量，但分片的数量理论上不可变更，唯一的办法就是重新创建索引。（实际上可以使用_shrink和_splitAPI更改索引的数量，不建议）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/2.%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/2.%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">2. 基本概念</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-18 10:22:01" itemprop="dateCreated datePublished" datetime="2024-07-18T10:22:01+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-20 13:10:20" itemprop="dateModified" datetime="2024-11-20T13:10:20+08:00">2024-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="2-基本概念"><a href="#2-基本概念" class="headerlink" title="2. 基本概念"></a>2. 基本概念</h1><h2 id="1-ES中的基本概念"><a href="#1-ES中的基本概念" class="headerlink" title="1. ES中的基本概念"></a>1. ES中的基本概念</h2><h3 id="1-1-索引（index）"><a href="#1-1-索引（index）" class="headerlink" title="1.1 索引（index）"></a>1.1 索引（index）</h3><p>索引是具有相似性文档的集合，可以快速检索数据。</p>
<h3 id="1-2-类型（type）（ES-6-x-废弃，ES-7-x-已删除）"><a href="#1-2-类型（type）（ES-6-x-废弃，ES-7-x-已删除）" class="headerlink" title="1.2 类型（type）（ES 6.x 废弃，ES 7.x 已删除）"></a>1.2 类型（type）（ES 6.x 废弃，ES 7.x 已删除）</h3><p>类型用于在索引内部进行逻辑分区，但在ES 7.x版本之后，类型的概念已经被完全删除。</p>
<h3 id="1-3-映射（mapping）"><a href="#1-3-映射（mapping）" class="headerlink" title="1.3 映射（mapping）"></a>1.3 映射（mapping）</h3><p>映射定义了索引中文档的结构和字段的类型，是ES动态识别文档内容并创建索引的依据。</p>
<h3 id="1-4-文档（document）"><a href="#1-4-文档（document）" class="headerlink" title="1.4 文档（document）"></a>1.4 文档（document）</h3><p>文档是ElasticSearch中的基本数据存储形式，文档中的数据以JSON结构进行存储。</p>
<h3 id="1-5-字段（field-）"><a href="#1-5-字段（field-）" class="headerlink" title="1.5 字段（field ）"></a>1.5 字段（field ）</h3><p>字段是文档中的一个属性，可以是任何数据类型。</p>
<h3 id="1-6-倒排索引"><a href="#1-6-倒排索引" class="headerlink" title="1.6 倒排索引"></a>1.6 倒排索引</h3><h4 id="1-6-1-正排索引"><a href="#1-6-1-正排索引" class="headerlink" title="1.6.1 正排索引"></a>1.6.1 正排索引</h4><p>正排索引也叫正向索引，建立的是从文档到词的对应关系。通常是先通过索引字段（例如id)找到文档，再查找文档中的词。传统关系型数据库大多使用正排索引。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id		name</span><br><span class="line">01		张飞</span><br><span class="line">02		张翼德</span><br></pre></td></tr></table></figure>

<p>优点：</p>
<ul>
<li>结构简单清晰，建立和维护容易</li>
<li>新文档加入时，以及直接为该文档建立新的索引块，并挂接在原有索引文件后面</li>
<li>文档删除时，可以直接找到对应索引并将其删除</li>
</ul>
<p>缺点：</p>
<ul>
<li>处理大量文档时，检索关键字的效率低，需要扫描所有的文档才能找到包含关键字的文档。</li>
</ul>
<h4 id="1-6-2-倒排索引"><a href="#1-6-2-倒排索引" class="headerlink" title="1.6.2 倒排索引"></a>1.6.2 倒排索引</h4><p>倒排索引也叫反向索引，建立的是从词或短语到文档的对应关系。通过关键字或词直接查找包含这些词的文档。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keyword		doc_id</span><br><span class="line">张			01,02</span><br><span class="line">飞			01</span><br><span class="line">翼德 		    02</span><br></pre></td></tr></table></figure>

<p>优点：</p>
<ul>
<li>检索高效：通过倒排索引，可以快速检索到包含指定词或短语的文档列表，大大提高了检索效率</li>
<li>支持复杂查询：倒排索引还可以记录词在文档处出现的位置、出现次数等信息，从而支持短语搜索、布尔搜索等复杂查询。</li>
</ul>
<h4 id="1-6-3-倒排索引的结构"><a href="#1-6-3-倒排索引的结构" class="headerlink" title="1.6.3 倒排索引的结构"></a>1.6.3 倒排索引的结构</h4><ul>
<li>词典：存储所有不同词语的列表，每个词语都有一个唯一标识（如id)</li>
<li>倒排列表：对于词典中的每一个词，都有一个倒排列表与其对应，该列表中存放了所有包含该词的文档的id列表，以及该词在文档中的位置、出现频次等额外信息。</li>
</ul>
<h3 id="1-7-DSL"><a href="#1-7-DSL" class="headerlink" title="1.7 DSL"></a>1.7 DSL</h3><p>ES的数据操作，采用的是RESTful 风格的API，通过HTTP接口使用JSON格式的语法进行数据操作。</p>
<h2 id="2-与关系型数据库的比较"><a href="#2-与关系型数据库的比较" class="headerlink" title="2. 与关系型数据库的比较"></a>2. 与关系型数据库的比较</h2><table>
<thead>
<tr>
<th><strong>RDBS</strong></th>
<th><strong>ES</strong></th>
</tr>
</thead>
<tbody><tr>
<td>数据库（database）</td>
<td>索引（index）</td>
</tr>
<tr>
<td>表（table）</td>
<td>类型（type）（ES6.0之后被废弃，es7中完全删除）</td>
</tr>
<tr>
<td>表结构（schema）</td>
<td>映射（mapping）</td>
</tr>
<tr>
<td>行（row）</td>
<td>文档（document）</td>
</tr>
<tr>
<td>列（column）</td>
<td>字段（field）</td>
</tr>
<tr>
<td>索引</td>
<td>倒排索引</td>
</tr>
<tr>
<td>SQL</td>
<td>DSL</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/1.%20%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/1.%20%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">1. 背景知识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-16 15:09:43" itemprop="dateCreated datePublished" datetime="2024-07-16T15:09:43+08:00">2024-07-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-20 13:10:03" itemprop="dateModified" datetime="2024-11-20T13:10:03+08:00">2024-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-背景知识"><a href="#1-背景知识" class="headerlink" title="1. 背景知识"></a>1. 背景知识</h1><h2 id="1-关于ElasticSearch"><a href="#1-关于ElasticSearch" class="headerlink" title="1. 关于ElasticSearch"></a>1. 关于ElasticSearch</h2><p>ElasticSearch 是建立在 Apache Lucene之上的<strong>高性能的分布式全文搜索引擎</strong>。<br>Lucene是一个基于Java的开源搜索引擎库，ES是基于其上构建的分布式系统，安全性和实时性更高，相比于Lucene复杂的Java API，ES采用RESTful API 和 JSON 数据格式，应用起来更简单。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">关于Lucene：</span><br><span class="line">Lucene是一种高性能、可伸缩的信息搜索（IR）库，最初由Doug Cutting开发，并在2000年开源。它是基于Java实现的高性能的开源项目，为软件开发人员提供了一个简单易用的工具包，以便在目标系统中实现全文检索的功能，或者是以此为基础建立起完整的全文检索引擎。Lucene采用了基于倒排表的设计原理，可以非常高效地实现文本查找，在底层采用了分段的存储模式，使它在读写时几乎完全避免了锁的出现，大大提升了读写性能。</span><br><span class="line"></span><br><span class="line">除了Elasticsearch之外，还有一些其他著名的项目也是建立在Lucene之上的，例如：</span><br><span class="line">    Apache Solr：Solr是一个基于Lucene的全文搜索服务器，也是最流行的企业级搜索引擎。它提供了全文检索、命中高亮、分面搜索、动态聚类、数据库集成，以及对富文本（如Word、PDF）的处理等功能。Solr高度可扩展，并提供了分布式搜索和索引复制等功能。</span><br><span class="line">    Hibernate Search：Hibernate Search是Hibernate对Lucene的一个集成方案，用于对数据库中的数据进行检索。它主要作用在于对数据表中某些内容庞大的字段（如声明为text的字段）建立全文索引，从而加快了对这些字段进行模糊搜索的速度。Hibernate Search会自动从Hibernate ORM实体中提取数据，以将其推送到本地Apache Lucene索引或远程Elasticsearch索引。</span><br><span class="line"></span><br><span class="line">这些项目都利用了Lucene的高性能、可扩展性和灵活性，通过在其基础上添加额外的功能和特性，来满足不同场景下的需求。Lucene作为全文检索技术的基石，为这些项目的成功提供了坚实的基础。</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">关于全文搜索：</span><br><span class="line">全文搜索，也称为全文检索，是指计算机索引程序通过扫描文章中的每一个词，并对这些词建立索引，指明它们在文章中出现的次数和位置。当用户进行查询时，检索程序会根据事先建立的索引进行查找，并将查找的结果反馈给用户。这个过程类似于通过字典中的检索字表查找某个字的过程。</span><br><span class="line">全文搜索的特点和优势</span><br><span class="line"></span><br><span class="line">    高效性：全文搜索通过索引机制，大大提高了检索效率，能够迅速定位到包含特定关键词的文档或数据。</span><br><span class="line">    全面性：它能够覆盖文档中的所有词汇，而不仅仅是标题或摘要，从而提供更全面的检索结果。</span><br><span class="line">    灵活性：支持复杂的查询语法和逻辑操作，用户可以根据需要构建精确的查询条件。</span><br><span class="line">    非结构化数据支持：全文搜索特别适用于非结构化数据的搜索，如邮件、Word文档、网页内容等，这些数据类型在关系型数据库中难以高效检索。</span><br><span class="line"></span><br><span class="line">全文搜索的方法</span><br><span class="line"></span><br><span class="line">全文搜索主要分为按字检索和按词检索两种。按字检索是以字为单位进行索引和检索，适用于中文等字符级语言；而按词检索则是以词为单位进行索引和检索，适用于英文等词汇级语言。不过，随着技术的发展，现代的全文搜索引擎通常能够支持多种语言和复杂的文本处理。</span><br><span class="line">全文搜索的应用</span><br><span class="line"></span><br><span class="line">全文搜索广泛应用于各种领域，如搜索引擎、文档管理系统、数字图书馆、学术论文检索等。其中，最常用的全文搜索引擎包括百度、谷歌（Google）等。这些搜索引擎通过爬取互联网上的网页，为它们建立索引，并允许用户通过关键词进行搜索，从而快速找到相关的网页和信息。</span><br><span class="line">全文搜索的技术实现</span><br><span class="line"></span><br><span class="line">全文搜索的实现依赖于一系列的技术和算法，包括文本预处理（如分词、去除停用词、词干提取等）、索引构建（如倒排索引）、查询处理（如查询解析、查询优化等）以及结果排序（如基于相关性或权重的排序）等。此外，随着大数据和人工智能技术的发展，全文搜索也在不断地融入新的技术和方法，如机器学习、深度学习等，以进一步提高检索的准确性和效率。</span><br><span class="line"></span><br><span class="line">综上所述，全文搜索是一种高效、全面、灵活的检索方式，它通过索引机制实现对非结构化数据的快速检索和查询。随着技术的不断进步和应用场景的不断拓展，全文搜索将在未来发挥更加重要的作用。</span><br></pre></td></tr></table></figure>



<h2 id="2-ElasticSearch的特性："><a href="#2-ElasticSearch的特性：" class="headerlink" title="2. ElasticSearch的特性："></a>2. ElasticSearch的特性：</h2><ul>
<li><p>弹性：系统在面对负载变化时，能够自动且快速地调整其资源使用量的能力，以保持系统的稳定性和性能。弹性的目标是确保系统在面临负载高峰时不会崩溃，同时在负载较低时不会浪费资源。</p>
</li>
<li><p>可伸缩性：系统能够处理不断增加的工作负载，而不需要对其进行根本性的修改或重构。一个可伸缩的系统应该能够随着负载的增加而增加处理能力，而不会导致性能的显著下降。可伸缩性通常分为水平可伸缩性（通过增加更多的节点或实例来扩展系统）和垂直可伸缩性（通过增加单个节点的处理能力来扩展系统）。</p>
</li>
<li><p>高可用性：通过分片和副本机制实现高可用</p>
</li>
<li><p>灵活性：Elasticsearch是一种非关系型数据库，但其不仅支持数据的全文搜索，还支持对结构化、半结构化、非结构化的数据的存储和查询分析。</p>
</li>
<li><p>近实时性：从数据的写入到被搜索到，通常只有一个很小的延迟（通常在1s以内）</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/0.%20%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%84%E7%BB%87%E5%BD%A2%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/0.%20%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%84%E7%BB%87%E5%BD%A2%E5%BC%8F/" class="post-title-link" itemprop="url">0. 数据的组织形式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-16 14:51:33" itemprop="dateCreated datePublished" datetime="2024-07-16T14:51:33+08:00">2024-07-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-20 13:09:54" itemprop="dateModified" datetime="2024-11-20T13:09:54+08:00">2024-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/ElasticSearch/" itemprop="url" rel="index"><span itemprop="name">ElasticSearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>369</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="0-数据的组织形式"><a href="#0-数据的组织形式" class="headerlink" title="0. 数据的组织形式"></a>0. 数据的组织形式</h1><h2 id="1-数据的组织形式"><a href="#1-数据的组织形式" class="headerlink" title="1. 数据的组织形式"></a>1. 数据的组织形式</h2><h3 id="1-1-结构化数据"><a href="#1-1-结构化数据" class="headerlink" title="1.1 结构化数据"></a>1.1 结构化数据</h3><p>能够通过一定结构来组织数据。例如关系型数据，数据之间存在一定的关系，可以使用二维表格的形式来组织数据。<br>关系型数据通常使用关系型数据库来存储，例如MySQL、oracle等数据库，并通过sql进行查询<br>优点：数据结构清晰、查询方便<br>缺点：在已有的数据结构上进行扩展比较困难</p>
<h3 id="1-2-非结构化数据"><a href="#1-2-非结构化数据" class="headerlink" title="1.2 非结构化数据"></a>1.2 非结构化数据</h3><p>无法通过特定结构来组织的数据。例如图片、音视频、报表、日志等。这些数据一般通过一些NoSQL数据库进行存储，例如MongoDB、Redis、HBase等数据库，通过k-v键值对的形式进行存储，使用key进行查询。查询相对较快。</p>
<h3 id="1-3-半结构化数据"><a href="#1-3-半结构化数据" class="headerlink" title="1.3 半结构化数据"></a>1.3 半结构化数据</h3><p>数据的结构和内容混在一起。例如HTML、XML、JSON数据等。这些数据一般也存储在MongoDB、Redis、HBase等数据库中。</p>
<p>缺点：内容查询较为困难。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hackertaizi.github.io/Python/Requests%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Taizi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="太子的个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 太子的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Python/Requests%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">Requests网络请求实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-07-15 17:19:26 / 修改时间：19:08:53" itemprop="dateCreated datePublished" datetime="2024-07-15T17:19:26+08:00">2024-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Requests网络请求实践"><a href="#Requests网络请求实践" class="headerlink" title="Requests网络请求实践"></a>Requests网络请求实践</h1><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h2><p>公司现有链式网站，可以近乎实时查询单台设备的状态数据。比通过大数据平台查询要快很多，但缺点也很明显，每次最多查看或导出3000条数据，查看非常不方便。为此，计划编写一个python脚本，通过调用网站相关接口，多次调用接口，将数据处理合并后写入一个excel文件。</p>
<h2 id="2-开发"><a href="#2-开发" class="headerlink" title="2. 开发"></a>2. 开发</h2><h3 id="2-1-浏览器开发者工具的使用"><a href="#2-1-浏览器开发者工具的使用" class="headerlink" title="2.1 浏览器开发者工具的使用"></a>2.1 浏览器开发者工具的使用</h3><blockquote>
<p>以下流程实践中我是倒着一步一步走过来的，因为对网络请求相关知识不熟悉，踩了很多坑。进行了大量测试，另外，感谢GPT！</p>
</blockquote>
<p>系统有两层登录鉴权，一层是用户中心，还有一层是系统本身。</p>
<p>这里首先要介绍一下浏览器的开发者工具，后面会另开博客详细学习介绍。打开网页前，按下“F12”键，可以打开开发者工具。从这里我们可以看到控制台、网络、内存等等很多版块。这次网络请求，主要查看的是网络版块，在触发页面操作，例如登录操作时，可以在该版块看到一系列相关的网络请求。</p>
<p>本次登录后，我们触发数据下载请求。在这个过程中，涉及到鉴权、下载接口调用等。</p>
<p>这里的开发者工具我们以火狐浏览器为例，其他浏览器大同小异</p>
<p><img src="/./Requests%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AE%9E%E8%B7%B5/e5oDbDeQTI.jpg" alt="e5oDbDeQTI"></p>
<p><img src="/./Requests%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AE%9E%E8%B7%B5/image-20240715172704329.png" alt="image-20240715172704329"></p>
<p><img src="/./Requests%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%AE%9E%E8%B7%B5/0F7xwuIYiF.jpg" alt="0F7xwuIYiF"></p>
<p>如上图，在点击下载按钮后，我发现对应的网络请求是<code>devPropertyExp</code>,然后点击该请求，可以看到一些非常关键的信息：</p>
<ul>
<li>请求的URL：可以看到请求类型（例如GET&#x2F;POST等)、请求接口地址等</li>
<li>请求头：可以看到很多与请求相关的格式等要求，例如上下文类型Content-Type，限定了请求体的格式等。还可以看到一些请求时在请求体中必要的参数，按我这次的经验来看，请求头参数中，前面没有小问号的参数一般是必填参数，python请求时最好在请求体里面加上。</li>
<li>请求体：包含了请求时必须告知服务器的一些参数，在请求体页面可以看到，一般在网页上是一些输入的信息或者选择的信息。</li>
</ul>
<h3 id="2-2-python网络请求包requests的使用"><a href="#2-2-python网络请求包requests的使用" class="headerlink" title="2.2 python网络请求包requests的使用"></a>2.2 python网络请求包requests的使用</h3><blockquote>
<p>有关python各种常用包的使用，后续会单独学习并建立博客，这里简单介绍一下使用</p>
</blockquote>
<p>引入requests包：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br></pre></td></tr></table></figure>

<p>触发请求：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST请求</span></span><br><span class="line">respon_obj = requests.post(</span><br><span class="line">	url = <span class="string">&#x27;请求的url&#x27;</span>,</span><br><span class="line">	data = <span class="string">&#x27;请求体&#x27;</span>,   <span class="comment"># 要注意请求头中的上下文类型，这里是一个json字符串还是一个json对象</span></span><br><span class="line">    header = <span class="string">&#x27;请求头&#x27;</span> <span class="comment"># 可以另外创建一个dict对象（键值对对象），这里直接引用</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GET请求</span></span><br><span class="line">respon_obj = requests.get(</span><br><span class="line">	url = <span class="string">&#x27;请求的url,可以直接附带参数，在?后附带参数param=value,多个参数用&amp;连接；也可以不带参数，把参数放在param选项里面&#x27;</span>,</span><br><span class="line">	data = &#123;请求体键值对&#125;,   <span class="comment"># 要注意请求头中的上下文类型，这里是一个json字符串还是一个json对象</span></span><br><span class="line">    header = &#123;请求头键值对&#125;, <span class="comment"># 可以另外创建一个dict对象（键值对对象），这里直接引用</span></span><br><span class="line">    params = &#123;参数键值对&#125; <span class="comment">#这里配置的参数，请求时python会拼接到url后面</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>返回值处理：</p>
<p>请求的返回结果是一个<code>requests.models.Response</code>对象，代表一个HTTP响应，无法直接使用，但是可以通过访问响应的内容（content）或文本（text）属性来获取内容的字符串表示。字符串一般是一个json对象，使用json包进行解析，并读取需要的属性即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">result = respon_obj.text</span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment"># 输出响应</span></span><br><span class="line">json_str = json.loads(result)</span><br><span class="line">token = json_str[<span class="string">&#x27;token&#x27;</span>]  <span class="comment"># 获取token</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-鉴权处理"><a href="#2-3-鉴权处理" class="headerlink" title="2.3 鉴权处理"></a>2.3 鉴权处理</h3><ul>
<li>获取本系统的token</li>
</ul>
<p>上面我们提到一个关键的数据下载接口是<code>devPropertyExp</code>，但直接调用会发现调用失败，因为请求头中必须包含token。token从何而来？我们看到上面有一个<code>exchangeToken</code>接口，并且其响应体中正是包含了这个token。从接口名我们可以看出，token通过交换得来的。然后在exchangeToken的请求头中，我们也可以看到一个Token参数，即调用这个接口可以获取本系统的token。</p>
<ul>
<li>获取用户中心的token</li>
</ul>
<p>这时就明白了，因为我们是先登录用户中心，然后再跳转这个系统，所以是先获取用户中心的token，然后使用用户中心的token换取这个系统的token。现在我们要看用户中心的token是怎么来的，这时我们继续往上回溯，可以看到一个<code>getTokenAndUserInfo</code>的GET 接口，这个接口的相应体中正好有我们要的用户中心的token，所以需要调用这个接口即可。<code>getTokenAndUserInfo</code>这个接口没有请求体，由于是一个GET接口，参数都在url后面，可以看到有一个code参数和一个client_id参数。多次调用发现client_id是不变的，而code参数每次调用都不一样。且同一个code调用一次后就失效了，所以这个code也相当于一个token的作用，怎么获取code呢？</p>
<ul>
<li>获取code</li>
</ul>
<p>继续向上回溯，还有一个GET方式的接口，这个方法的响应体正是这个code！但是这个GET接口的url中也有一个名为domainToken的参数，所以，想要调用这个接口还需要获取domainToken</p>
<ul>
<li>获取domainToken</li>
</ul>
<p>继续向上回溯，就剩一个OPTIONS类型的接口了。这个接口的url中也有domainToken，并且这个接口没有响应体和请求体。测试发现这个domainToken可以重复使用，不清楚有没有时效（大概率是有的），但是没法再向上回溯了。只好将domainToken写死在代码里面了。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">正向梳理整个过程：</span><br><span class="line">通过浏览器开发者工具获取domainToken &gt; 调用GET类型接口获取code &gt; 调用getTokenAndUserInfo接口获取用户中心Token &gt; 调用exchangeToken接口换取本系统的token &gt; 借助本系统的token，调用devPropertyExp获取数据</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Powered by Hackertaizi</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">224k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:47</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
